<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="homeStayMaintain.css">
    <link rel="stylesheet" href="index.css">
    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <title>民宿维护</title>
</head>

<body>
    <div id="homeStayMaintain">
        <el-form :inline="true" :model="formInline" class="demo-form-inline">
            <div id="search-box">
                <div id="search-left">
                    <el-form-item label="民宿名称">
                        <el-input v-model="name" placeholder="请输入" size="mini"></el-input>
                    </el-form-item>
                    <el-form-item label="房东姓名">
                        <el-input v-model="house_name" placeholder="请输入" size="mini"></el-input>
                    </el-form-item>
                    <el-form-item label="运营类别">
                        <el-select v-model="category" placeholder="请选择" size="mini">
                            <el-option label="自营" value="1"></el-option>
                            <el-option label="民居" value="2"></el-option>
                        </el-select>
                    </el-form-item>
                </div>
                <div id="search-right">
                    <el-form-item>
                        <el-button type="primary" size="mini" @click="searchHomeStay">查询</el-button>
                        <el-button type="info" size="mini" @click="resetHomeStay">重置</el-button>
                    </el-form-item>
                </div>
            </div>
        </el-form>
        <el-button size="mini" icon="el-icon-plus" type="primary" class="add-homestay-btn">新建</el-button>
        <el-table :data="tableData" stripe style="width: 100%;">
            <el-table-column prop="name" label="民宿名称">
            </el-table-column>
            <el-table-column prop="category" label="运营类别">
            </el-table-column>
            <el-table-column prop="house_name" label="房东姓名">
            </el-table-column>
            <el-table-column prop="number" label="房型数量">
            </el-table-column>
            <el-table-column prop="time" label="创建时间">
            </el-table-column>
            <el-table-column prop="recommend" label="推荐" width="180">
            </el-table-column>
            <el-table-column label="操作">
                <el-button icon="el-icon-edit" circle size="mini" type="primary"></el-button>
                <el-button icon="el-icon-info" circle size="mini"></el-button>
            </el-table-column>
        </el-table>
        <div id="footer-page-box">
            <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange"
                :current-page="currentPage" :page-sizes="[5, 10, 20, 50]" :page-size="100"
                layout="total, sizes, prev, pager, next, jumper" :total="totalNum">
            </el-pagination>
        </div>


    </div>

    <script>
        new Vue({
            el: '#homeStayMaintain',
            data: {
                formInline: {
                    user: '',
                    region: ''
                },
                currentPage: 1,
                tableData: [],
                everyPageNum: 5,
                totalNum: 0,
                name: '',
                house_name: '',
                category: ''

            },
            methods: {
                handleSizeChange(val) {
                    this.everyPageNum = val;
                    this.queryHomestayList();
                },
                handleCurrentChange(val) {
                    this.currentPage = val;
                    this.queryHomestayList();
                },
                // 页面请求数据
                queryHomestayList() {
                    let that = this;
                    let data = {
                        'size': `${this.everyPageNum}`,
                        'order': `${this.currentPage}`,
                        'name': `${this.name}`,
                        'house_name': `${this.house_name}`,
                        'category': `${this.category}`
                    }
                    $.ajax({
                        url: 'https://api.sdzhujialin.com/admin/Index/IndexData',
                        data: data,
                        type: 'POST',
                        dataType: 'json',
                        success(res) {
                            that.totalNum = res.data.total;
                            that.tableData = res.data.data;
                            that.tableData.map(e=>{
                                e.category = e.category == 1 ? '自营' : '民居';
                                return e;
                            });
                        },
                        error(err) {
                            console.log(err.msg);
                        }
                    })
                },
                // 查询民宿
                searchHomeStay() {
                    let tempCategory = this.category == '自营' ? 1 : 2;
                    if (!this.name && !this.house_name && !tempCategory) {
                        this.noSearchTip();
                    } else {
                        this.queryHomestayList();
                    }
                },
                // 重置民宿
                resetHomeStay(){
                    this.name = '';
                    this.house_name = '';
                    this.category = '';
                    this.queryHomestayList();
                },
                // 未填写搜索条件提示
                noSearchTip() {
                    this.$message({
                        message: '搜索条件未填写',
                        type: 'warning'
                    });
                }
            },
            mounted() {
                this.queryHomestayList();
            },
            watch: {
                name(){
                    if(!this.name && !this.house_name && !this.tempCategory){
                        this.queryHomestayList();
                    }
                },
                house_name(){
                    if(!this.name && !this.house_name && !this.tempCategory){
                        this.queryHomestayList();
                    }
                },
                category(){
                    if(!this.name && !this.house_name && !this.tempCategory){
                        this.queryHomestayList();
                    }
                }
            },
        })
    </script>


</body>

</html>